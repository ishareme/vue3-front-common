import{F as B,L as V,a as N,v as Q,E as R,b as j}from"./validate-0e6a3b11.js";import{a1 as G,a2 as Y,Y as D,a3 as q,h as P,s as S,o as L,a as I,y as H,z as W,k as w,i as v,a4 as U,a5 as X,a6 as J,a7 as K,a8 as Z,a9 as ee,g as z,P as te,C as ne,j as F,u as _,b as oe,d as se,aa as ie,l as ae}from"./index-562e6ff2.js";const E="LOGIN_SUCCESS_CHANNEL";let C=null;window.BroadcastChannel&&(C=new BroadcastChannel(E));const re=x=>{C?C.postMessage(x):localStorage.setItem(E,JSON.stringify(x))},ce=()=>new Promise(x=>{C?C.onmessage=a=>{x(a.data)}:localStorage.onstorage=a=>{a.key===E&&x(JSON.parse(a.newValue))}}),le=()=>{C?(C.close(),C=null):localStorage.removeItem(E)},k={send:re,wait:ce,clear:le},M=async(x,a)=>{if(await G.dispatch("user/login",{loginType:x,...a})===Y){D("success",`欢迎你 ${a.nickname}, 请创建你的账号`,6e3),q.push({path:"/register",query:{reqType:x,...a}});return}q.push("/")},de={id:"qqLoginBtn"},ue="https://graph.qq.com/oauth2.0/authorize?client_id=101998494&response_type=token&scope=all&redirect_uri=https%3A%2F%2Fimooc-front.lgdsunday.club%2Flogin",he={__name:"QQLogin",setup(x){const a=()=>{c()},c=()=>{window.open(ue,"oauth2Login_10609","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),k.wait().then(h=>{k.clear(),M(U,h)})};return P(()=>{QC.Login({btnId:"qqLoginBtn"},(h,p)=>{console.log("qq登录成功",h,p),QC.Login.signOut();const e=/access_token=((.*))&expires_in/.exec(window.location.hash)[1],{nickname:s,figureurl_qq_2:t}=h,i={nickname:s,figureurl_qq_2:t,accessToken:e};k.send(i),M(U,i),window.close()})}),(h,p)=>{const e=S("SvgIcon");return L(),I("div",null,[H(w("span",de,null,512),[[W,!1]]),v(e,{class:"w-4 cursor-pointer",name:"qq",onClick:a})])}}},pe=w("div",{id:"loginContainer"},null,-1),me={__name:"WeixinLogin",setup(x){if(window.location.search){const c=/code=((.*))&state/.exec(window.location.search)[1];c&&(k.send(c),window.close())}const a=async()=>{try{const{appId:c,appSecret:h,redirectUri:p,scope:e,state:s}=await X();window.open(`https://open.weixin.qq.com/connect/qrconnect?appid=${c}&redirect_uri=${p}&response_type=code&scope=${e}&state=${s}#wechat_redirect`,"","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),k.wait().then(async({code:t})=>{k.clear();const{access_token:i,openid:r}=await J(c,h,t),{nickname:l,headimgurl:d}=await K(i,r);M(Z,{openid:r,nickname:l,headimgurl:d})})}catch(c){console.log("[ error ]",c)}};return a(),(c,h)=>{const p=S("SvgIcon");return L(),I("div",null,[v(p,{class:"w-4 cursor-pointer",name:"wexin",onClick:a}),pe])}}};(function(){function x(e){var s=document.getElementById(e.id),t=typeof e=="object"&&e;return new h(s,t)}var a=function(){var e=arguments.length,s=arguments[0]||{},t,i,r;for(typeof s!="object"&&typeof s!="function"&&(s={}),e==1&&(s=this,t--),t=1;t<e;t++){i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},c=function(e){return typeof e=="function"&&typeof e.nodeType!="number"},h=function(e,s){this.$element=e,this.options=a({},h.DEFAULTS,s),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()},p;h.VERSION="1.0",h.Author="beheroto@gmail.com",h.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"正在加载中...",failedText:"再试一次",barText:"向右滑动填充拼图",repeatIcon:"iconfont iconfont-shuaxin",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(Math.random()*4)+".jpg"},verify:function(e,s){var t=!1;return $.ajax({url:s,data:{datas:JSON.stringify(e)},dataType:"json",type:"post",async:!1,success:function(i){t=JSON.stringify(i),console.log("返回结果："+t)}}),t},remoteUrl:""},window.sliderCaptcha=x,window.sliderCaptcha.Constructor=h,p=h.prototype,p.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},p.initDOM=function(){var e=function(b,T){var y=document.createElement(b);return y.className=T,y},s=function(b,T){var y=document.createElement("canvas");return y.width=b,y.height=T,y},t=s(this.options.width-2,this.options.height),i=t.cloneNode(!0),r=e("div","sliderContainer"),l=e("i","refreshIcon "+this.options.repeatIcon),d=e("div","sliderMask"),o=e("div","sliderbg"),n=e("div","slider"),u=e("i","iconfont icon-arrow-right sliderIcon"),m=e("span","sliderText"),g,f;i.className="slider-captcha-block",m.innerHTML=this.options.barText,g=this.$element,g.appendChild(t),g.appendChild(l),g.appendChild(i),n.appendChild(u),d.appendChild(n),r.appendChild(o),r.appendChild(d),r.appendChild(m),g.appendChild(r),f={canvas:t,block:i,sliderContainer:r,refreshIcon:l,slider:n,sliderMask:d,sliderIcon:u,text:m,canvasCtx:t.getContext("2d"),blockCtx:i.getContext("2d")},c(Object.assign)?Object.assign(this,f):a(this,f)},p.initImg=function(){var e=this,s=window.navigator.userAgent.indexOf("Trident")>-1,t=this.options.sliderL+this.options.sliderR*2+3,i=function(o,n){var u=e.options.sliderL,m=e.options.sliderR,g=e.options.PI,f=e.x,b=e.y;o.beginPath(),o.moveTo(f,b),o.arc(f+u/2,b-m+2,m,.72*g,2.26*g),o.lineTo(f+u,b),o.arc(f+u+m-2,b+u/2,m,1.21*g,2.78*g),o.lineTo(f+u,b+u),o.lineTo(f,b+u),o.arc(f+m-2,b+u/2,m+.4,2.76*g,1.24*g,!0),o.lineTo(f,b),o.lineWidth=2,o.fillStyle="rgba(255, 255, 255, 0.7)",o.strokeStyle="rgba(255, 255, 255, 0.7)",o.stroke(),o[n](),o.globalCompositeOperation=s?"xor":"destination-over"},r=function(o,n){return Math.round(Math.random()*(n-o)+o)},l=new Image,d;l.crossOrigin="Anonymous",d=0,l.onload=function(){e.x=r(t+10,e.options.width-(t+10)),e.y=r(10+e.options.sliderR*2,e.options.height-(t+10)),i(e.canvasCtx,"fill"),i(e.blockCtx,"clip"),e.canvasCtx.drawImage(l,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(l,0,0,e.options.width-2,e.options.height);var o=e.y-e.options.sliderR*2-1,n=e.blockCtx.getImageData(e.x-3,o,t,t);e.block.width=t,e.blockCtx.putImageData(n,0,o+1),e.text.textContent=e.text.getAttribute("data-text")},l.onerror=function(){if(d++,window.location.protocol==="file:"&&(d=e.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),d>=e.options.maxLoadCount){e.text.textContent="加载失败",e.classList.add("text-danger");return}l.src=e.options.localImages()},l.setSrc=function(){var o="",n;d=0,e.text.classList.remove("text-danger"),c(e.options.setSrc)&&(o=e.options.setSrc()),o&&o!==""||(o="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(Math.random()*200)),s?(n=new XMLHttpRequest,n.onloadend=function(u){var m=new FileReader;m.readAsDataURL(u.target.response),m.onloadend=function(g){l.src=g.target.result}},n.open("GET",o),n.responseType="blob",n.send()):l.src=o},l.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=l},p.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},p.bindEvents=function(){var e=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){e.text.textContent=e.options.barText,e.reset(),c(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var s,t,i=[],r=!1,l=function(n){e.text.classList.contains("text-danger")||(s=n.clientX||n.touches[0].clientX,t=n.clientY||n.touches[0].clientY,r=!0)},d=function(n){var u;if(!r)return!1;var m=n.clientX||n.touches[0].clientX,g=n.clientY||n.touches[0].clientY,f=m-s,b=g-t;if(f<0||f+40>e.options.width)return!1;e.slider.style.left=f-1+"px",u=(e.options.width-60)/(e.options.width-40)*f,e.block.style.left=u+"px",e.sliderContainer.classList.add("sliderContainer_active"),e.sliderMask.style.width=f+4+"px",i.push(Math.round(b))},o=function(n){var u,m;if(!r||(r=!1,u=n.clientX||n.changedTouches[0].clientX,u===s))return!1;e.sliderContainer.classList.remove("sliderContainer_active"),e.trail=i,m=e.verify(),m.spliced&&m.verified?(e.sliderContainer.classList.add("sliderContainer_success"),c(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,i)):(e.sliderContainer.classList.add("sliderContainer_fail"),c(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.innerHTML=e.options.failedText,e.reset()},1e3))};this.slider.addEventListener("mousedown",l),this.slider.addEventListener("touchstart",l),document.addEventListener("mousemove",d),document.addEventListener("touchmove",d),document.addEventListener("mouseup",o),document.addEventListener("touchend",o),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},p.verify=function(){var e=this.trail,s=parseInt(this.block.style.left),t=!1;if(this.options.remoteUrl!==null)t=this.options.verify(e,this.options.remoteUrl);else{var i=function(n,u){return n+u},r=function(n){return n*n},l=e.reduce(i)/e.length,d=e.map(function(n){return n-l}),o=Math.sqrt(d.map(r).reduce(i)/e.length);t=o!==0}return{spliced:Math.abs(s-this.x)<this.options.offset,verified:t}},p.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}})();const fe={class:"fixed top-[20%] left-[50%] translate-x-[-50%] w-[340px] h-[270px] text-sm bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-900 shadow-2xl"},ge={class:"flex items-center h-5 text-left px-1 mb-1"},xe=w("span",{class:"flex-grow dark:text-zinc-200"},"请完成安全验证",-1),be=w("div",{id:"captcha"},null,-1),A="close",O="success",ve={__name:"SliderCaptcha",emits:[A,O],setup(x,{emit:a}){let c=null;P(()=>{c=sliderCaptcha({id:"captcha",async onSuccess(e){try{await ee({behavior:e})&&a(O)}catch{a(O)}},onFail(){console.log("[ onFail ]")},verify(){return console.log("[ verify ]"),!0}})});const h=()=>{c.reset()},p=()=>{a(A)};return(e,s)=>{const t=S("SvgIcon");return L(),I("div",fe,[w("div",ge,[xe,v(t,{name:"refresh",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:h}),v(t,{name:"close",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"ml-2 w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:p})]),be])}}},we={class:"relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200"},_e={class:"block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg"},Ce=w("h3",{class:"hidden mb-2 font-semibold text-base text-main dark:text-zinc-300 xl:block"}," 登录账号 ",-1),ye={class:"flex justify-around mt-4"},Se={__name:"index",setup(x){const a=z(!1),c=z(!1),h=()=>{a.value=!0},p=()=>{a.value=!1,i()},e=te(),s=ne(),t=z({username:"",password:""}),i=async()=>{c.value=!0;try{await e.dispatch("user/login",{...t.value,loginType:ie}),s.push("/")}catch{s.push("/")}finally{c.value=!1}},r=()=>{s.push("/register")};return(l,d)=>{const o=S("HButton");return L(),I("div",we,[v(V),w("div",_e,[Ce,v(_(B),{onSubmit:h},{default:F(()=>[v(_(N),{type:"text",class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:default:bg-zinc-900",name:"username",placeholder:"用户名",autocomplete:"auto",rules:_(Q),modelValue:t.value.username,"onUpdate:modelValue":d[0]||(d[0]=n=>t.value.username=n)},null,8,["rules","modelValue"]),v(_(R),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"username"}),v(_(N),{type:"password",class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:default:bg-zinc-900",name:"password",placeholder:"password",autocomplete:"auto",rules:_(j),modelValue:t.value.password,"onUpdate:modelValue":d[1]||(d[1]=n=>t.value.password=n)},null,8,["rules","modelValue"]),v(_(R),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"password"}),w("div",{class:"pt-1 pb-3 leading-[0] text-right"},[w("a",{class:"inline-block p-1 text-zinc-400 text-right dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-300 cursor-pointer",onClick:r},"去注册")]),v(o,{loading:c.value,class:"w-full dark:bg-zinc-900 xl:dark:text-zinc-800"},{default:F(()=>[ae("登录")]),_:1},8,["loading"])]),_:1}),w("div",ye,[v(he),v(me)])]),a.value?(L(),oe(_(ve),{key:0,onClose:d[2]||(d[2]=n=>a.value=!1),onSuccess:p})):se("",!0)])}}};export{Se as default};
