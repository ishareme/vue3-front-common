import{g as r,c as _,h as O,m as C,p as j,o as p,a as f,N as A,O as K,D as H,r as P,d as q,E as S}from"./index-562e6ff2.js";const z=n=>{const t=[];return n.forEach(o=>{t.push(...o.getElementsByTagName("img"))}),t},D=n=>n.map(t=>t.src),R=n=>{const t=n.map((o,m)=>new Promise(c=>{const u=new Image;u.onload=()=>{c({url:o,index:m})},u.onerror=()=>{c({error:!0})},u.src=o}));return Promise.all(t)},x=n=>Math.min(...Object.values(n)),I=n=>{const t=x(n);return Object.keys(n).find(o=>n[o]===t)},U=n=>Math.max(...Object.values(n)),$={__name:"index",props:{data:{type:Array,required:!0},nodeKey:{type:String},column:{default:2,type:[Number,String]},columnSpacing:{default:20,type:[Number,String]},rowSpacing:{default:20,type:[Number,String]},preloading:{type:Boolean,default:!0}},setup(n){const t=n,o=r(null),m=r(0),c=r(0),u=r(0),T=r(0),N=()=>{const{paddingLeft:e,paddingRight:a,paddingTop:l}=window.getComputedStyle(o.value,null);u.value=parseFloat(e),T.value=parseFloat(l),m.value=o.value.offsetWidth-parseFloat(e)-parseFloat(a)},i=r(0),b=_(()=>(t.column-1)*t.columnSpacing),h=()=>{N(),i.value=(m.value-b.value)/t.column};O(()=>{h()});let g=[];const s=r({}),k=()=>{s.value={};for(let e=0;e<t.column;e++)s.value[e]=0},y=()=>{t.data.forEach((e,a)=>{e._style||(e._style={left:B(),top:M()},F(a))}),c.value=U(s.value)},B=()=>I(s.value)*(i.value+t.columnSpacing)+u.value,M=()=>x(s.value),F=e=>{const a=I(s.value);s.value[a]+=g[e]+t.rowSpacing},L=()=>{g=[];let e=[...document.getElementsByClassName("waterfall-item")];const a=z(e),l=D(a);R(l).then(()=>{g=e.map(d=>d.offsetHeight),y()})},W=()=>{g=[...document.getElementsByClassName("waterfall-item")].map(a=>a.offsetHeight),y()};C(()=>t.data,e=>{S(()=>{e.every(l=>!l._style)&&k(),t.preloading?L():W()})},{deep:!0,immediate:!0});const v=()=>{setTimeout(()=>{h(),t.data.forEach(e=>{e._style=null})},100)};return C(()=>t.column,()=>{t.preloading?(i.value=0,S(()=>{v()})):v()}),j(()=>{t.data.forEach(e=>{delete e._style})}),(e,a)=>(p(),f("div",{class:"relative",ref_key:"containerTarget",ref:o,style:H({height:c.value+"px"})},[i.value&&n.data.length?(p(!0),f(A,{key:0},K(n.data,(l,d)=>{var E,w;return p(),f("div",{key:n.nodeKey?l[n.nodeKey]:d,class:"waterfall-item absolute duration-300",style:H({width:i.value+"px",left:((E=l._style)==null?void 0:E.left)+"px",top:((w=l._style)==null?void 0:w.top)+"px"})},[P(e.$slots,"default",{item:l,width:i.value,index:d})],4)}),128)):q("",!0)],4))}};export{$ as default};
